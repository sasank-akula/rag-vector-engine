sap.ui.define(["com/ai/ragadminui/controller/BaseController","sap/ui/model/json/JSONModel","sap/base/util/uid","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],(e,t,n,i,o,s,a)=>{"use strict";return e.extend("com.ai.ragadminui.controller.Main",{onInit:function(){this._oDSC=this.byId("DynamicSideContent");this._showSideContentButton=this.byId("showSideContentButton");this.flag=0},_getLoggedInUserDetails:function(){let e=this._getServicePath()+"/user-api/currentUser";let n=this;$.ajax({url:e,type:"GET",dataType:"json",async:true,success:function(e){let i=new t(e);n.getView().setModel(i,"UserData");n.handleSideContentHide(i.getData())},error:function(){i.show("Fething User Details failed")}})},onAfterRendering:function(){this._getLoggedInUserDetails();let e=this._oDSC.getCurrentBreakpoint();this.updateToggleButtonState(e)},handleSliderChange:function(e){let t=e.getParameter("value");this.updateControlWidth(t)},updateControlWidth:function(e){let t=this.byId("sideContentContainer").$();if(e){t.width(e+"%")}},handleBreakpointChangeEvent:function(e){let t=e.getParameter("currentBreakpoint");this.updateToggleButtonState(t);this.updateShowSideContentButtonVisibility(t)},updateToggleButtonState:function(e){let t=this.byId("toggleButton");t.setEnabled(e==="S")},updateShowSideContentButtonVisibility:function(e){let t=!(e==="S"||this._oDSC.isSideContentVisible());this._showSideContentButton.setVisible(t)},handleToggleClick:function(){this._oDSC.toggle()},handleSideContentHide:function(e){let t=e.scopes||[];console.log(t);let n=t.inludes("rag-vector-engine-9d5a94ectrial-dev!t485944.ChatBotAdmin");console.log(n);this.getView().getModel("UserData").setProperty("/showSideContent",n)},handleSideContentShow:function(){this._oDSC.setShowSideContent(true);this.updateShowSideContentButtonVisibility(this._oDSC.getCurrentBreakpoint())},onSendMessage:async function(){if(this.flag===0){this.convId=n();this.flag=1}await this._getRagResponse(this.convId)},onReloadChat:function(){this.convId=n();const e=this.getView().getModel("oChatModel");e.setProperty("/list",[])},onFileSizeExceed:function(e){o.warning("File size exceeds the 5 MB limit.")},onChange:function(e){debugger;const t=e.getParameter("files");this.onAfterItemAdded(t[0])},onAfterItemAdded:async function(e){debugger;const t=new FileReader;t.onload=async t=>{const n=t.target.result.split(",")[1];const o={getMediaType:()=>e.type,getFileName:()=>e.name,getFileObject:()=>e,base64Content:n};this._showBusy(true);try{await this.createEntity(o);i.show(`File is Uploading.....`);this.byId("idList").getBinding("items").refresh()}catch(e){console.error("Upload failed:",e);i.show("Upload failed")}finally{this._showBusy(false)}};t.onerror=e=>{console.error("File reading error:",e);i.show("File read error")};t.readAsDataURL(e)},onUploadCompleted:function(){const e=this.byId("UploadCollection");e.getBinding("items").refresh()},fileSizeExceed:function(e){o.warning("File size exceeded. Maximum allowed is 250 KB.")},typeMissmatch:function(e){o.warning("Invalid file type. Only PDFs are allowed.")},createEntity:async function(e){const t={ID:self.crypto.randomUUID(),mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size.toString(),content:e.base64Content};this.ODataPost("/DocumentFiles",t);this.byId("idList").getBinding("items").refresh()},_getEmbeddingResponse:async function(e){const t=sessionStorage.getItem("isDeployedVersion")==="true"?this._getServicePath()+"/odata/v4/embedding-storage/storeEmbeddings":"/odata/v4/embedding-storage/storeEmbeddings";return new Promise((n,o)=>{$.ajax({url:t+"(documentID='"+e+"')",method:"GET"}).done(e=>{i.show("you can ask now..")}).fail(e=>{o(e)})})},onFileDeleted:async function(e){const t=e.getParameter("listItem");const n=t.getBindingContext().getProperty("ID");this._showBusy(true);try{await this.deleteItemById(n);i.show("File deleted successfully.");this.byId("idList").getBinding("items").refresh()}catch(e){i.show("Error deleting file.");console.error(e)}finally{this._showBusy(false)}},deleteItemById:function(e){const t=this.getView().getModel();const n=t.bindList("/DocumentFiles");const i=new s("ID",a.EQ,e);return n.filter(i).requestContexts().then(function(e){if(e.length>0){return e[0].delete()}else{return Promise.reject("No matching item found")}})},_showBusy:function(e){const t=this.getView();t.setBusyIndicatorDelay(0);t.setBusy(e)},onDeleteDocumentPress:async function(e){await this.deleteItemById(e.getParameter("documentId"));i.show("FileDeleted event triggered.")},onSearchDocuments:function(e){const t=e.getParameter("query");const n=this.byId("idList");const i=n.getBinding("items");if(t&&t.length>0){const e=new s("fileName",a.Contains,t);i.filter([e])}else{i.filter([])}},updateFileCount:function(e){let t=e.getParameter("total");let n=this.byId("documentCount");if(t&&n){n.setText("Documents ("+t+")")}}})});
//# sourceMappingURL=Main.controller.js.map